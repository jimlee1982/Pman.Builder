{"xtype":"*Module","app":"Builder","modkey":444,"|module":"Pman.Tab.BuilderTop2","region":"north","|parent":"Pman.Tab.Builder","name":"Pman.Tab.BuilderTop2","listeners":{},"items":[{"xtype":"ContentPanel","background":true,"fitToFrame":true,"region":"center","listeners":{"|activate":"function (_self)\n{\n   this.panel=_self;\n}"},"items":[{"xtype":"Toolbar","*prop":"toolbar","listeners":{},"items":[{"xtype":"Button","|xns":"Roo.Toolbar","text":"Module:","listeners":{},"items":[{"xtype":"Array","*prop":"menu","listeners":{},"items":[{"xtype":"Item","|xns":"Roo.menu","text":"Create  Module","listeners":{"|click":"function (_self, e)\n{\n   Pman.Dialog.BuilderAppEdit.show({\n           id : 0\n       },function(data) {\n           if (data) {\n              _this.modsel.setFromData(data);\n           }\n       });\n}"},"|icon":" Ext.rootURL + 'images\/default\/dd\/drop-add.gif'"},{"xtype":"Item","|xns":"Roo.menu","text":"Edit Module","listeners":{"|click":"function (_self, e)\n{\n if (!_this.modsel.lastData || !_this.modsel.lastData.id) {\n         Roo.MessageBox.alert(\"Error\", \"Select Module\");\n          return false;\n  }\n  Pman.Dialog.BuilderAppEdit.show( _this.modsel.lastData ,function(data) {\n        if (data) {\n                 _this.modsel.setFromData(data);\n          }\n      });\n}"}},{"xtype":"Item","|xns":"Roo.menu","text":"Delete Module","listeners":{"|click":"function (_self, e)\n{\n;\n    Pman.request({\n          url : baseURL + '\/Roo\/Builder_app.php',\n          params : { \n              _delete :    _this.modsel.getValue(),\n         },\n         method : 'GET',\n        success : function() {\n            _this.filesel.reset();\n            _this.filesel.fireEvent('select', false);\n      }\n     });\n    \n}"}}]}]},{"xtype":"ComboBox","|xns":"Roo.form","listeners":{"|select":"function (combo, record, index)\n{\n _this.filesel.reset();\n                             _this.filesel.fireEvent('select', false);\n}","|collapse":"function (combo)\n{\n this.lastQuery = '~~~~~~~~'; \/\/ force a query!\n}","|render":"function (_self)\n{\n_this.modsel = this;\n}"},"selectOnFocus":true,"width":100,"editable":false,"displayField":"app","valueField":"id","typeAhead":false,"forceSelection":true,"triggerAction":"all","tpl":"<div class=\"x-grid-cell-text x-btn button\"><b>{app}<\/b> <\/div>","loadingText":"Searching....","listWidth":"300","pageSize":25,"items":[{"xtype":"Store","|xns":"Roo.data","*prop":"store","listeners":{},"remoteSort":true,"|sortInfo":" { field : 'app' , direction : 'ASC' }","|reader":"Pman.Readers.Builder_app","items":[{"xtype":"HttpProxy","*prop":"proxy","listeners":{},"|url":"baseURL + '\/Roo\/Builder_app.php'","method":"GET"}]}]},{"xtype":"Button","|xns":"Roo.Toolbar","text":"Component:","listeners":{},"items":[{"xtype":"Array","*prop":"menu","listeners":{},"items":[{"xtype":"Item","|xns":"Roo.menu","text":"New  Component","listeners":{"|click":"function (_self, e)\n{\n    if (!_this.modsel.lastData || !_this.modsel.lastData.id) {\n        Roo.MessageBox.alert(\"Error\", \"Select Application\");\n        return false;\n    }\n                                    \n    _this.filesel.setFromData({\n        id : 0,\n        name : ''\n    });\n    Pman.Tab.BuilderTree.clearAll();\n    Pman.Tab.BuilderTree.tree.root.elConfig.app = _this.modsel.lastData.app;\n    Pman.Tab.BuilderTree.setCurrentNode(Pman.Tab.BuilderTree.tree.root,true);\n                                    \n    var bp = Pman.Tab.BuilderPanel;\n    bp.redraw.defer(100,bp,[true]);\n}"},"|icon":" Ext.rootURL + 'images\/default\/dd\/drop-add.gif'"},{"xtype":"Item","|xns":"Roo.menu","text":"Delete Component","listeners":{},"|icon":"rootURL + '\/Pman\/templates\/images\/trash.gif'"}]}]},{"xtype":"ComboBox","|xns":"Roo.form","listeners":{"|select":"function(cb, rec, ix) {\n     var bt = Pman.Tab.BuilderTree;\n                            if (!rec) {\n                                bt.clearAll();\n                                bt.setCurrentNode(bt.tree.root,true);\n                                var bp = Pman.Tab.BuilderPanel;\n                                bp.redraw.defer(100,bp,[true]);\n                                return;\n                            }\n                            \n                            bt.loadJSON.defer(10, bt, [rec.data.json]);\n    }","|collapse":"function (combo)\n{\n this.lastQuery = '~~~~~~~~'; \/\/ force a query!\n}","|render":"function (_self)\n{\n_this.filesel = this;\n}"},"selectOnFocus":true,"width":200,"editable":false,"displayField":"name","valueField":"id","typeAhead":false,"forceSelection":true,"triggerAction":"all","tpl":"<div class=\"x-grid-cell-text x-btn button\"> <B>[{module}]<\/B> {name} <\/div>","loadingText":"Searching....","listWidth":400,"pageSize":25,"items":[{"xtype":"Store","|xns":"Roo.data","*prop":"store","listeners":{"|beforeload":"function (_self, o)\n{\n o.params = o.params || {}; \n                                o.params.btype = 'FORM';\n                                if (!_this.modsel.lastData || !_this.modsel.lastData.id) {\n                                    Roo.MessageBox.alert(\"Error\", \"Select Application\");\n                                    return false;\n                                }\n                                o.params.app = _this.modsel.lastData.app;\n}"},"remoteSort":true,"|sortInfo":" { field : 'app' , direction : 'ASC' }","|reader":"Pman.Readers.Builder","items":[{"xtype":"HttpProxy","*prop":"proxy","listeners":{},"|url":"baseURL + '\/Roo\/Builder.php'","method":"GET"}]}]},{"xtype":"SplitButton","|xns":"Roo.Toolbar","text":"Save","listeners":{"|render":"function (_self)\n{\n  _this.saveBtn = _self;\n}","|click":"function (_self, e, afterclick)\n{\n\n    var t = Pman.Tab.BuilderTree.tree;\n    if (!t.root.elConfig.name.length) {\n            Roo.MessageBox.alert(\"Error\", \"No name set for form\");\n            return;\n    }\n    var sid =  _this.filesel.lastData ? _this.filesel.lastData.id : 0;\n    var js = Pman.Tab.BuilderTree.toJS();\n    var json = Roo.encode(js);\n       \n        \n       \n    var postCode = function(data)\n    {\n        \/\/ this needs more thought..\n       \/\/ Pman.\n        if ((data.app.length < 2) || (data.code.length < 50)) {\n           _this.statusBtn.setText(\"Data to short\");\n            return;\n        }\n        \n        if (!_this.modsel.lastData || !_this.modsel.lastData.davwrite || !_this.modsel.lastData.davurl.length) {\n             _this.statusBtn.setText(\"Dav Off \/ Not set\");\n            return;\n        }\n        var durl = _this.modsel.lastData.davurl.replace(\/\\\/$\/, '');\n         _this.statusBtn.setText(\"Saving to DAV\");\n        Pman.request({\n            url: durl + '\/' + data.module + '.js',\n            method : 'PUT',\n            params: data.code,\n            success : function(data) {\n               \/\/ console.log('put data');\n             _this.statusBtn.setText(\"Saved to DAV\");\n            }, \n            failure : function(resp, o) {\n                if (resp.status == 204) {\n                 _this.statusBtn.setText(\"Saved to DAV\");\n                    return true; \/\/ saved - updated\n                }\n                 if (resp.status == 201) {\n                 _this.statusBtn.setText(\"Saved to DAV\");\n                    return true; \/\/ saved - new\n                }\n                 _this.statusBtn.setText(\"Dav Error - see console\");\n                console.log(resp);\n                console.log(o);\n                \/\/return true; \/\/ we handle it!!!\n            }\n        });\n        \n    };\n\n    \n   _this.statusBtn.setText(\"Saving\");\n    \n     Pman.request({\n            url: baseURL + '\/Roo\/Builder.php',\n            method : 'POST',\n            params : {\n                json : json,\n                name : t.root.elConfig.name,\n                module : t.root.elConfig['|module'],\n                app : t.root.elConfig.app,\n                btype : 'FORM',\n                id : sid,\n                gitpath : _this.modsel.lastData.gitpath\n            }, \n            success : function(data) {\n                \/\/ set the fileSel!!\n                console.log(data);\n                if (data) {\n                    _this.filesel.setFromData(data);\n                    if (afterclick) {\n                        \/\/ shows view code if nec.\n                        afterclick.call(_this,data);\n                        \n                    }\n                    postCode(data);\n                }\n                \n            }\n            \n        });\n\n\n    \n    \n}"},"cls":"x-btn-text-icon","|icon":"rootURL + '\/Pman\/templates\/images\/save.gif'","items":[{"xtype":"Array","*prop":"menu","listeners":{},"items":[{"xtype":"Item","|xns":"Roo.menu","text":"Save a Copy","listeners":{"|click":"function (_self, e)\n{\n   Pman.Dialog.BuilderSaveAs.show({\n       id : 0,\n       app: _this.filesel.lastData.app\n   });\n       \n}"},"|icon":"rootURL + '\/Pman\/templates\/images\/save.gif'"}]}]},{"xtype":"Button","|xns":"Roo.Toolbar","text":"View Javascript","listeners":{"|click":"function (_self, e)\n{\n\n    _this.saveBtn.fireEvent('click', _this.saveBtn, e, function()\n    {\n        Pman.Dialog.BuilderViewCode.show( {\n           id: _this.filesel.getValue()\n        });\n        \n    });\n}"},"|icon":"Roo.rootURL + 'images\/default\/tree\/leaf.gif'","cls":"x-btn-text-icon"},{"xtype":"SplitButton","|xns":"Roo.Toolbar","text":"Redraw","listeners":{"|click":"function (_self, e)\n{\n var bp = Pman.Tab.BuilderPanel;\n                            bp.redraw.defer(100,bp,[true]);\n\n}","|render":"function (_self)\n{\n    _this.redrawBtn = _self;\n    _this.redrawBtn.auto = 1;\n\n}"},"|icon":"rootURL + '\/Pman\/templates\/images\/refresh.gif'","cls":"x-btn-text-icon","items":[{"xtype":"Array","*prop":"menu","listeners":{},"items":[{"xtype":"Item","|xns":"Roo.menu","text":"Auto Redraw - OFF","listeners":{"|click":"function (_self, e)\n{\n   _this.redrawBtn.setText(\"Redraw (AUTO OFF)\");\n                                        _this.redrawBtn.auto = 0\n}"}},{"xtype":"Item","|xns":"Roo.menu","text":"Auto Redraw - ON","listeners":{"|click":"function (_self, e)\n{\n  \n      _this.redrawBtn.setText(\"Redraw\");\n                                        _this.redrawBtn.auto = 1;\n                                        var bp = Pman.Tab.BuilderPanel;\n                                        bp.redraw.defer(100,bp,[true]);\n\n    \n   \n}"}}]}]},{"xtype":"Button","|xns":"Roo.Toolbar","text":"Status","listeners":{"|render":"function (_self)\n{\n  _this.statusBtn = _self;\n}"},"disabled":true}]}]}],"title":"Builder - Top Toolbar"}